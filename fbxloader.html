<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        html,
        body {
            margin: 0;
            height: 100%;
        }

        .d-flex {
            display: flex;
        }

        .flex-row {
            flex-flow: row;
        }

        .flex-column {
            flex-flow: column;
        }

        .w-50 {

            padding: 10px;
            width: 50%;
        }

        .container {
            position: relative;
            overflow: hidden;
            width: 100%;
            padding-top: 100%;
        }

        .responsive {
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            width: 100%;
            height: 100%;
        }

        canvas {
            width: 100% !important;
            height: 100% !important;
            max-height: 400px !important;
        }
    </style>
</head>

<body>
    <div class="d-flex flex-row">
        <div class="w-50 d-flex flex-column">
            <h4>Option-1 Scaled 1 in FBX <br>(Working fine)</h4>
            <div class="container">
                <div class="responsive">
                    <canvas id="canvas1"></canvas>
                </div>
            </div>
        </div>
        <div class="w-50 d-flex flex-column">
            <h4>Option-2 Scaled 0.1 in FBX <br>(Looks very small)</h4>
            <div class="container">
                <div class="responsive">
                    <canvas id="canvas2"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script type="module">

        import * as THREE from "https://cdn.jsdelivr.net/npm/three@0.117.1/build/three.module.js";
        import { OrbitControls } from "https://cdn.jsdelivr.net/npm/three@0.117.1/examples/jsm/controls/OrbitControls.js";
        import { FBXLoader } from "https://cdn.jsdelivr.net/npm/three@0.117.1/examples/jsm/loaders/FBXLoader.js";
        window.FBXLoader = FBXLoader;
        const thv = function (canvasRef, objectUrl) {

            var camera, scene, renderer, mesh, material, stats, plane, planeBuffer, controls, width, height;
            init();
            animate();

            console.log('canvasRef.clientWidth, canvasRef.clientHeight = ', canvasRef.clientWidth, canvasRef.clientHeight)

            function init() {
                width = canvasRef.clientWidth;
                height = canvasRef.clientHeight;
                // Renderer.
                renderer = new THREE.WebGLRenderer({
                    antialias: true,
                    shadow: true,
                    clearColor: true,
                    canvas: canvasRef
                });
                renderer.setSize(width, height);
                renderer.shadowMap.enabled = true;
                renderer.shadowMap.type = THREE.PCFSoftShadowMap;
                renderer.setClearColor("#ddd");

                renderer.setPixelRatio(window.devicePixelRatio);

                renderer.gammaFactor = 2.2;
                renderer.gammaOutput = true;

                renderer.physicallyCorrectLights = true;

                // document.body.appendChild(renderer.domElement);

                // Create camera.
                camera = new THREE.PerspectiveCamera(90, width / height, 1, 1000);
                camera.position.z = 550;

                controls = new OrbitControls(camera, renderer.domElement);

                // Create scene.
                scene = new THREE.Scene();

                // const light1 = new THREE.PointLight(0xffffff, 1, 100);
                // light1.position.set(50, 50, 50);
                // scene.add(light1); 

                //Create ambient light and add to scene.
                const color = 0xFFFFFF;
                const intensity = 1;
                const light = new THREE.AmbientLight(color, intensity);
                scene.add(light);

                // Create directional light and add to scene.
                //   const spotLight = new THREE.SpotLight( 0xffffff );
                //   spotLight.position.set( 100, 100, 100 );
                //   scene.add(spotLight);
                //   const spotLightHelper = new THREE.SpotLightHelper( spotLight );
                //   scene.add( spotLightHelper );

                // Create directional light and add to scene.
                // var directionalLight = new THREE.DirectionalLight(0xffffff, 2);
                // directionalLight.position.set(50, 50, 50);
                // directionalLight.castShadow = false;
                // directionalLight.shadow.darkness = 0;
                // directionalLight.shadow.radius = 1;
                // directionalLight.shadow.camera.top = 600;
                // directionalLight.shadow.camera.bottom = 600;
                // directionalLight.shadow.camera.left = 600;
                // directionalLight.shadow.camera.right = 600;
                // directionalLight.shadow.camera.near = 3;
                // directionalLight.shadow.camera.far = 700;
                // directionalLight.shadow.bias = -0.006;
                // directionalLight.shadow.mapSize.width = 600;
                // directionalLight.shadow.mapSize.height = 600;
                // directionalLight.shadowMapSoft = false;
                // scene.add(directionalLight);
                // const helper = new THREE.DirectionalLightHelper(directionalLight, 5);
                // scene.add(helper);

                //   let planeGeometry = new THREE.PlaneBufferGeometry(1000, 1000);
                //   planeGeometry.rotateX(-Math.PI / 2);

                //   let planeMaterial = new THREE.ShadowMaterial();
                //   planeMaterial.opacity = 0.09;

                //   plane = new THREE.Mesh(planeGeometry, planeMaterial);
                //   plane.position.y = -0;
                //   scene.add(plane);
                //   plane.name = "plan";

                //   plane.receiveShadow = true;
                //   scene.add(new THREE.BoxHelper(plane))

                window.addEventListener('resize', onWindowResize, false);

                addModalToScene(objectUrl)
            }

            let scope = {};
            this.scope = scope;

            function addModalToScene(objectUrl) {

                let fbxLoader = new FBXLoader();

                fbxLoader.load(
                    objectUrl, //1
                    object => {

                        scene.add(object);
                        object.traverse(it => {
                            if (it.isMesh) {
                                it.receiveShadow = true;
                                it.castShadow = true;
                                scope.os = object.scale;
                                console.log(it)
                            }
                        })

                        let boxHelper = new THREE.Box3Helper(new THREE.Box3());

                        boxHelper.visible = true;
                        boxHelper.box.setFromObject(object);

                        plane.position.y = boxHelper.box.min.y;

                    },
                    xhr => {
                        //          console.log((xhr.loaded / xhr.total) * 100 + "% loaded");
                    },
                    // called when loading has errors
                    error => {
                        console.log("An error happened" + error);
                    }
                );
            }

            function animate() {
                requestAnimationFrame(animate);
                renderer.render(scene, camera);
                // stats.update();
            }

            function onWindowResize() {
                width = canvasRef.clientWidth;
                height = canvasRef.clientHeight;
                camera.aspect = width / height;
                camera.updateProjectionMatrix();
                renderer.setSize(width, height);
            }

        };

        var canvas1 = document.getElementById('canvas1');
        var canvas2 = document.getElementById('canvas2');

        window._thv1 = new thv(canvas1, "fbx.fbx");
        //   console.log(_thv1.scope);
        window._thv2 = new thv(canvas2, "fbx.fbx");
        console.log(_thv2.scope);

    </script>

</body>

</html>